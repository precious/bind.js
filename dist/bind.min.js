var Bind=function e(t){"use strict";function n(e){return(e+"").replace(/[<>]/g,function(e){return{">":"&gt;","<":"&lt;"}[e]})}function r(e,t){for(var n=e.length,r=0;n>r;r++)t(e[r],r,e)}function i(e,t){var n="pop push reverse shift sort splice unshift".split(" ");r(n,function(n){this[n]=function(){this.__dirty=!0;var r=c({},u[n].apply(this,arguments));return delete this.__dirty,e&&t.ready&&e(this),r}.bind(this)}.bind(this)),this.replaceWith=function(e){this.splice.apply(this,[0,this.length].concat(e))};var i=this.length;return Object.defineProperty(this,"length",{configurable:!1,enumerable:!0,set:function(e){if(this.__dirty)return void(i=e);var t=1*e;return i!==t&&(t>i?this.push.apply(this,new Array(t-i)):this.splice(t),i=t),e},get:function(){return i}}),this}function a(e,t,s,u){return u||(u=[]),s.ready&&t.__callback?e:(r(Object.getOwnPropertyNames(t),function(y){if("__callback"!==y){var v,b=t[y],g=[].slice.call(u),m=function(e){return n(e)},_=d,k=!1;g.push(y);var A=s.mapping[g.join(".")];if(A&&"[object Object]"===A.toString()&&(A.callback&&(v=A.callback),A.transform&&(m=p(A.transform.bind({safe:n}))),A.parse&&(_=p(A.parse)),A.mirror&&(k=A.mirror),A=A.dom),"function"==typeof A)v=A;else if("string"==typeof A){var E=o(A||"☺");0===E.length&&console.warn('No elements found against "'+A+'" selector');var O=["SELECT","INPUT","PROGRESS","TEXTAREA"],N=["password","text","search","email","url","tel","number"];if(null===b||void 0===b)if(-1!==O.indexOf(E[0].nodeName))if("checkbox"===E[0].type){b=[];for(var T=0,j=E.length;j>T;T++)E[T].checked&&b.push(_(E[T].value))}else b=_(E[0].value);else b=_(E[0].innerHTML);var S=v;v=function(t){E=o(A||"☺"),E&&r(E,function(e){if(!e.__dirty)if(-1!==O.indexOf(e.nodeName)){var n=m(t);if("checkbox"===e.type){if(t instanceof Array){var i=t.filter(function(t){return t===e.value?(e.checked=e.value===t,!0):void 0});0===i.length&&(e.checked=!1)}}else if("radio"===e.type)e.checked=e.value===n;else if("number"==typeof e.value)try{e.value=1*n}catch(a){console.error(a.message)}else e.value=n}else{t instanceof Array||(t=[t]);var c="";r(t,function(e){c+=m(e)}),e.innerHTML=c}}),S&&S.apply(e,arguments)},r(E,function(t){if("INPUT"===t.nodeName||"SELECT"===t.nodeName||"TEXTAREA"===t.nodeName){var n=function(){this.__dirty=!0;var n;if("checkbox"===t.type){var i=(t.form||document).querySelectorAll('input[name="'+t.name+'"][type="'+t.type+'"]');if(e[y]instanceof Array){var a=[];r(i,function(e){e.checked&&a.push(_(e.value))}),n=a}else n=this.checked?_(this.value):null}else"radio"===t.type&&(n=this.checked?_(this.value):null),n=_("number"==typeof e[y]?1*this.value:this.value);if(void 0===n&&(n=this.value),e[y]=n,k&&("TEXTAREA"===t.nodeName||"INPUT"===t.nodeName&&-1!==N.indexOf(t.type))&&"string"==typeof n&&this.value!==n){var c=this,o=this.selectionStart-(this.value.length-n.length),l=document.activeElement===this&&this.selectionStart==this.selectionEnd;this.value=n,l&&setTimeout(function(){c.setSelectionRange(o,o)},0)}this.__dirty=!1},i={checkbox:"change",radio:"change","select-one":"change","select-multiple":"change"}[t.type];t.addEventListener(i||"input",n)}})}v&&g.reduce(function(e,t,n,r){return e[t]||(e[t]={}),n===r.length-1&&(e[t].__callback=v),e[t]},s.callbacks);var x=function(e){var t=[],n=[],r=s.instance,i=!1,a=!1;if(l&&console.log("> finding callback for %s",y,g),g.reduce(function(o,l,s){if(o&&o[l]&&l){if(r=r[l],null===r||void 0===r)return o[l]||{};if("function"==typeof o[l].__callback){var u=s===g.length-1?e:r;r.__dirty&&(i=!0),s===g.length-1&&o[l].__callback&&(a={path:g.join("."),callback:o[l].__callback,instance:u}),i||(n.push(c(u instanceof Array?[]:{},u)),t.push(o[l].__callback))}return o[l]||{}}},s.callbacks),i||(n.reverse(),t.reverse().forEach(function(e,t){e.call(s.instance,n[t])})),i&&a){var r=a.instance;a.callback.call(s.instance,c(r instanceof Array?[]:{},r))}},P={configurable:!0,enumerable:!0,set:function(t){var n=b!==t?b:void 0;b=!s.ready||typeof t!==h||null===t||f(t)||t.__callback?f(t)?a(new i(x,s),t,s,g):t:a(e[y]?c({},e[y]):{},t,s,g),l&&console.log("set: key(%s): %s -> %s",y,JSON.stringify(n),JSON.stringify(t)),s.ready?x(b):s.deferred.push(x.bind(e,b,n))},get:function(){return b}};try{Object.defineProperty(e,y,P)}catch(w){}typeof b!==h||null===b||f(b)?f(b)?e[y]=a(new i(x,s),b,s,g):e instanceof i||(e[y]=b):e[y]=a(e[y]||{},b,s,g)}}),e instanceof i&&e.push.apply(e,t),e)}function c(t,n){return n instanceof Object?(r(Object.getOwnPropertyNames(n),function(r){var i=n[r];e.prototype[r]||"__callback"===r||(t[r]=typeof i===h&&null!==i&&i instanceof Array?[].map.call(i,function(e){return e instanceof Object?c(t[r]||{},e):e}):typeof i!==h||null===i||f(i)?i:c(t[r]||{},i))}),t):n}function e(n,i){if(!this||this===t)return new e(n,i);var c={mapping:i||{},callbacks:{},deferred:[],ready:!1,instance:this};return a(this,n,c),c.ready=!0,c.deferred.length&&r(c.deferred,function(e){e()}),this}if(!Function.bind||!Object.defineProperty)throw new Error("Prerequisite APIs not available.");var o,l=!1;try{o=document.querySelectorAll.bind(document)}catch(s){}var u=[],f=Array.isArray,h="object",d=function(e){return e},p=function(e){return function(){try{return e.apply(this,arguments)}catch(t){console.error(t.stack?t.stack:t)}}};return i.prototype=[],e.prototype.__export=function(){return c({},this)},e}(this);"undefined"!=typeof exports&&(module.exports=Bind);